# SDP Workflow Rules

These rules apply automatically when working with projects using Spec-Driven Protocol.

## Slash Commands

When receiving a command, use the corresponding prompt:

| Command | Prompt |
|---------|--------|
| `/idea {description}` | `@prompts/commands/idea.md` |
| `/design {slug}` | `@prompts/commands/design.md` |
| `/build {WS-ID}` | `@prompts/commands/build.md` |
| `/review {feature}` | `@prompts/commands/review.md` |
| `/deploy {feature}` | `@prompts/commands/deploy.md` |
| `/oneshot {feature}` | `@prompts/commands/oneshot.md` |
| `/issue {description}` | `@prompts/commands/issue.md` |
| `/hotfix {description}` | `@prompts/commands/hotfix.md` |
| `/bugfix {description}` | `@prompts/commands/bugfix.md` |

## Required Files to Read

Before ANY workstream work, FIRST read:

```bash
# 1. Project Map ‚Äî architecture decisions
cat docs/PROJECT_MAP.md

# 2. INDEX ‚Äî existing WS
cat docs/workstreams/INDEX.md
```

## Automatic Checks

### Pre-build (before /build)
```bash
hooks/pre-build.sh {WS-ID}
```

### Post-build (after /build)
```bash
hooks/post-build.sh {WS-ID} {module}
```

## Git Workflow

### Branch Naming
```
feature/{slug}     # For new features
fix/{slug}         # For fixes
```

### Conventional Commits
```
feat({scope}): WS-XXX-XX - description
test({scope}): WS-XXX-XX - add tests
docs({scope}): WS-XXX-XX - execution report
fix({scope}): description
refactor({scope}): description
```

### Workflow
```
/design ‚Üí git checkout -b feature/{slug}
/build  ‚Üí git commit -m "feat({scope}): WS-XXX-XX - ..."
/review ‚Üí check git log
/deploy ‚Üí git merge --no-ff, git tag, cleanup
```

### Install Git Hooks
```bash
ln -sf ../../hooks/pre-commit.sh .git/hooks/pre-commit
ln -sf ../../hooks/commit-msg.sh .git/hooks/commit-msg
```

## Forbidden

‚ùå Creating WS without Goal + Acceptance Criteria
‚ùå Referencing non-existent WS
‚ùå Using time estimates (days/hours)
‚ùå Leaving TODO/FIXME in code
‚ùå Accepting WS with coverage < 80%
‚ùå Ignoring regression tests

## Substream Format

When splitting WS into parts:

```
WS-{PARENT}-{SEQ}

PARENT = 3 digits (060)
SEQ = 2 digits (01, 02...)

‚úÖ WS-060-01, WS-060-02, WS-060-10
‚ùå WS-060-1, WS-60-01, WS-060-A
```

## Clean Architecture

```
Domain     ‚Üí DOES NOT import infrastructure/presentation
Application ‚Üí DOES NOT import infrastructure directly
Infrastructure ‚Üí Implements ports from application
Presentation ‚Üí Uses only application
```

## File Limits

| LOC | Zone | Action |
|-----|------|--------|
| < 150 | üü¢ | OK |
| 150-200 | üü° | Consider split |
| > 200 | üî¥ | Must split |

## Type Hints (Python 3.10+)

```python
# ‚úÖ Correct
def func(data: str, count: int = 0) -> list[str]:
    ...

def void_func() -> None:
    ...

# ‚ùå Wrong
def func(data):  # No types
    ...

def void_func():  # Missing -> None
    ...
```
